```{r}
# Load required libraries
library(sf)
library(mapview)
library(ggplot2)
library(ggspatial)

# Read data
parking<-read.csv("Parking.csv")
business<-read.csv("business.csv")

# Convert the business dataset to a spatial object
business_sf <- st_as_sf(business, coords = c("long", "lat"), crs = 4326)

# Convert the parking dataset to a spatial object
parking_sf <- st_as_sf(parking, coords = c("lng", "lat"), crs = 4326)

# Perform a spatial join to find the nearest business for each parking space
nearest_business <- st_nearest_feature(parking_sf, business_sf)

# Add the nearest business information to the parking dataset
parking_data_with_nearest_business <- cbind(parking, nearest_business)

#Display data on map
map<-parking_data_with_nearest_business %>%
  st_as_sf(
    coords=c("lng","lat"),
    crs=4326
  )

map %>% mapview()

```

```{r}
parking_data_with_nearest_business$traffic_volume = c(100, 150, 90, 50, 250, 75, 65, 40)


# Define a scoring function
calculate_score <- function(traffic_volume, lat, lng, capacity, nearest_businesses) {
  # Define weights for each factor
  weights <- c(0.3, 0.1, 0.1, 0.2, 0.3)
  
  # Normalize each factor
  normalized_traffic <- (traffic_volume - min(traffic_volume)) / (max(traffic_volume) - min(traffic_volume))
  normalized_capacity <- (capacity - min(capacity)) / (max(capacity) - min(capacity))
  normalized_distance <- (nearest_businesses - min(nearest_businesses)) / (max(nearest_businesses) - min(nearest_businesses))
  
  # Calculate the score
  score <- weights[1] * normalized_traffic +
    weights[2] * normalized_capacity +
    weights[3] * normalized_distance +
    weights[4] * lat +
    weights[5] * lng
  
  return(abs(score))
}

# Calculate score for each parking spot
parking_data_with_nearest_business$score <- calculate_score(parking_data_with_nearest_business$traffic_volume, parking_data_with_nearest_business$lat, parking_data_with_nearest_business$lng, parking_data_with_nearest_business$capacity, parking_data_with_nearest_business$nearest_business)

# Rank the parking spots based on the score
ranked_data <- parking_data_with_nearest_business[order(-parking_data_with_nearest_business$score),]

# Print the ranked data
print(ranked_data)
```
```{r}
highest_score_index <- which.max(ranked_data$score)
highest_score_parking_spot <- parking_data_with_nearest_business[highest_score_index, ]

# Print the parking spot with the highest score
print(highest_score_parking_spot)
```
